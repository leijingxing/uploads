# 仓库协作指南

## 项目结构与模块组织
- `main.go` 是 Gin 服务器入口，包含路由、元数据读写与二维码工具；扩展功能时先在此整理逻辑再考虑拆分。
- `templates/` 保存 `index.html`、`details.html`、`upload.html` 等视图，通用片段应集中在此目录复用。
- `static/` 提供样式与提取后的图标，自动生成的图标需保留在 `static/icons/`，确保详情卡片正常显示。
- `uploads/` 用于存放运行期 APK，禁止提交到版本库；清理应用或构建记录时同步移除孤立文件。
- `metadata.json` 记录项目、应用与构建状态，任何文件操作都要保持其同步更新。

## 构建、测试与开发命令
- `go run main.go` 在 `:1234` 启动服务，用于手动验证上传、列表与详情流程。
- `go build ./...` 确认编译通过，提交评审或上线前必须执行。
- `go test ./...` 运行全部测试，可用 `-run` 精确筛选调试目标。
- `go fmt ./...` 与 `go mod tidy` 在提交前统一格式并整理依赖。

## 编码风格与命名约定
- 全面遵循 `gofmt`（制表符缩进、分组导入），避免手工对齐。
- 导出标识使用帕斯卡命名，局部变量采用小驼峰，常量仅在语义需要时使用全大写蛇形。
- 处理函数保持精简，复用逻辑抽离为辅助函数，并沿用现有互斥锁守护共享状态。
- HTML 使用语义化类名（如 `.app-list`、`.upload-form`），样式统一写入 `static/style.css`。

## 测试规范
- 将测试放在同目录 `*_test.go` 中，优先使用表驱动覆盖处理器、元数据持久化与二维码生成。
- 测试时将 `metadataFilePath` 指向临时目录，确保备份恢复流程覆盖真实场景。
- 合并前执行 `go test -cover ./...`，并在评审说明中补充覆盖率变化或待补场景。

## 提交与合并请求规范
- 遵循历史记录风格：简短、动作导向、无句号，可用中英文描述，例如 `优化上传流程复用校验`。
- 相关改动尽量合并为单个提交，若涉及 API 或数据结构变更需在正文说明。
- 合并请求需包含变更摘要、`go test` 结果（界面调整附截图）、关联问题编号及 `metadata.json`/备份文件的处理方式。
- 仅在分支可编译、自动生成文件未纳入差异时请求评审。

## 安全与配置提示
- 对上传 APK 进行安全扫描，屏蔽来源不明的构建。
- 生产环境保持 `uploads/` 可写但不可浏览，通过反向代理关闭目录列表。
- 定期轮换并妥善保护 `metadata.json` 备份，确保高并发写入时原子重命名成功。
